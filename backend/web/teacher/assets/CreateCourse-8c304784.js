import{d as H,o as c,c as d,a as t,t as p,F,h as k,g as b,e as x,i as f,k as I,p as B,j as U,l as C,v as O,m as V,q as y,n as T}from"./teacher-6ecb1640.js";import{_ as v}from"./_plugin-vue_export-helper-c27b6911.js";import{F as g,A as M}from"./fileLoader-be8b590c.js";const D=H("course",{state:()=>({courseId:"",name:"",language:"",description:"",price:0,free:!1,hidden:!1,lessonItems:[],deleteLessonFileItems:[],deleteLessonItems:[]}),actions:{validateMainInfoCourse(){if(this.name==="")return{error:"Укажите название курса"};if(this.language==="")return{error:"Укажите язык курса"};if(!this.free&&this.price===0)return{error:"Укажите цену курса или установите его бесплатным"}},async sendSaveCourse(s){let e=this.validateMainInfoCourse();if(e)throw e;for(let r=0;r<this.lessonItems.length;r++){const l=this.lessonItems[r];if(l.title==="")throw{error:`Укажите название для урока #${l.lessonNumber}`};if(l.exerciseItems.length===0)throw{error:`Создайте задания для урока #${l.lessonNumber}`}}return await fetch("/teacher/save-course",{method:"POST",body:JSON.stringify({deleteFiles:s,main:{courseId:this.courseId,name:this.name,language:this.language,hidden:this.hidden,description:this.description,price:this.free?0:this.price}})})},async sendSaveLessonForSavedCourse(s=0){for(let e=0;e<this.lessonItems.length;e++)this.lessonItems[e].id!==void 0&&this.lessonItems[e].id!==0&&(this.lessonItems[e].lessonNumber=e+1);return await fetch("/teacher/save-lessons",{method:"POST",body:JSON.stringify({courseId:s,lessonItems:this.lessonItems,deleteLessonFileItems:this.deleteLessonFileItems,deleteLessonItems:this.deleteLessonItems})})},async sendCreateCourse(){let s=this.validateMainInfoCourse();if(s)throw s;for(let e=0;e<this.lessonItems.length;e++){const r=this.lessonItems[e];if(r.title==="")throw{error:`Укажите название для урока #${r.lessonNumber}`};if(r.exerciseItems.length===0)throw{error:`Создайте задания для урока #${r.lessonNumber}`}}return await fetch("/teacher/create-course",{method:"POST",body:JSON.stringify({name:this.name,language:this.language,hidden:this.hidden,description:this.description,price:this.free?0:this.price})})},async sendAddLessonsToCreatedCourse(s=0){return await fetch("/teacher/add-lessons",{method:"POST",body:JSON.stringify({courseId:s,lessonItems:this.lessonItems})})},async sendGetCourseByID(){try{return await fetch(`/teacher/get-course?id=${this.courseId}`).then(s=>s.json())}catch(s){console.error(s)}}}});const w=D(),R={name:"ExerciseTestAuto",props:{exerciseNumber:Number,lessonNumber:Number,isEditCourse:Boolean},data(){return{exerciseData:{type:"testAuto",name:"",taskDescription:"",task:{type:"",correctAnswer:null,expandBrackets:null}},textData:{name:"Название задания",taskDescription:"Описание задания",task:{type:"",correctAnswer:null,expandBrackets:null}},timeoutWatchExerciseData:null}},watch:{isEditCourse:{immediate:!0,handler(s){s&&Object.keys(this.exerciseData).forEach(e=>{switch(this.exerciseData[e]=w.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1][e],e){case"name":this.textData[e]=this.exerciseData[e];return;case"taskDescription":this.textData[e]=this.exerciseData[e];return;case"task":this.textData[e]=this.exerciseData[e],console.log(this.textData[e]);return}})}},exerciseData:{immediate:!0,deep:!0,handler(s){clearTimeout(this.timeoutWatchExerciseData),this.timeoutWatchExerciseData=setTimeout(()=>{w.$patch(e=>{e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1]={...e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1],...s}})},1e3)}}},methods:{setSubTitle(s){this.exerciseData.name=s.target.innerText},setTaskDescription(s){this.exerciseData.taskDescription=s.target.innerText},setContentCorrectAnswer(s,e){e.phrase=s.target.innerText},setAnswerToExpandBrackets(s,e){e.answer=s.target.innerText},selectTest(s){switch(this.exerciseData.task.type=s,s){case"correctAnswer":this.exerciseData.task.expandBrackets=null,this.exerciseData.task.correctAnswer=[{id:0,phrase:"",answer:!1}];break;case"expandBrackets":this.exerciseData.task.correctAnswer=null,this.exerciseData.task.expandBrackets={text:"",answerItems:[]}}},addPhraseToCorrectAnswer(){this.exerciseData.task.correctAnswer.push({id:this.exerciseData.task.correctAnswer.length-1,phrase:"",answer:!1})},removePhraseFromCorrectAnswer(s){this.exerciseData.task.correctAnswer.splice(s,1)},addInputToExpandBrackets(){this.exerciseData.task.expandBrackets.answerItems.push({id:this.exerciseData.task.expandBrackets.answerItems.length-1,answer:""})},removeExercise(){w.lessonItems[this.lessonNumber-1].exerciseItems.splice(this.exerciseNumber-1,1)}}},W={class:"task"},J={class:"task-header"},$=["innerHTML"],z=["innerHTML"],G={key:0,class:"content-test"},q={class:"correct-answer-list"},K=["onInput"],Q=["innerHTML"],X=["onClick"],Y=["onClick"],Z=["onClick"],ee={key:1,class:"content-test"},se={class:"contenteditable",contenteditable:"true"},te=["innerHTML"],ie={class:"correct-answer-list"},re=["onInput"],ne={class:"select-test-list"};function oe(s,e,r,l,n,i){return c(),d("div",W,[t("div",J,[t("p",null,"Задание #"+p(r.exerciseNumber),1),t("button",{class:"btn-red",onClick:e[0]||(e[0]=(...o)=>i.removeExercise&&i.removeExercise(...o))},"Удалить задание")]),t("div",{class:"contenteditable sub-title",contenteditable:"true",onInput:e[1]||(e[1]=(...o)=>i.setSubTitle&&i.setSubTitle(...o))},[t("h2",{innerHTML:n.textData.name},null,8,$)],32),t("div",{class:"contenteditable description-task",contenteditable:"true",onInput:e[2]||(e[2]=(...o)=>i.setTaskDescription&&i.setTaskDescription(...o))},[t("h3",{innerHTML:n.textData.taskDescription},null,8,z)],32),n.exerciseData.task.correctAnswer!=null?(c(),d("div",G,[t("ul",q,[(c(!0),d(F,null,k(n.exerciseData.task.correctAnswer,(o,u)=>(c(),d("li",{key:"exercise_"+o.id},[t("span",null,p(u+1)+")",1),t("div",{class:"contenteditable",contenteditable:"true",onInput:a=>i.setContentCorrectAnswer(a,o)},[t("p",{innerHTML:n.textData.task.correctAnswer[u].phrase},null,8,Q)],40,K),o.answer?(c(),d("button",{key:0,class:"btn-correct",onClick:a=>o.answer=!1},"Верный",8,X)):(c(),d("button",{key:1,class:"btn-incorrect",onClick:a=>o.answer=!0},"Не верный",8,Y)),n.exerciseData.task.correctAnswer.length>1?(c(),d("button",{key:2,class:"span-plus",onClick:a=>i.removePhraseFromCorrectAnswer(u)},"- ",8,Z)):b("",!0)]))),128)),t("li",null,[t("button",{class:"span-plus",onClick:e[3]||(e[3]=(...o)=>i.addPhraseToCorrectAnswer&&i.addPhraseToCorrectAnswer(...o))},"+")])])])):b("",!0),n.exerciseData.task.expandBrackets!=null?(c(),d("div",ee,[t("div",se,[t("p",{innerHTML:n.textData.task.expandBrackets.text},null,8,te)]),t("button",{class:"btn-blue",onClick:e[4]||(e[4]=(...o)=>i.addInputToExpandBrackets&&i.addInputToExpandBrackets(...o))},"Добавить поле"),t("ul",ie,[(c(!0),d(F,null,k(n.exerciseData.task.expandBrackets.answerItems,(o,u)=>(c(),d("li",{key:o.id},[t("span",null,p(u+1),1),t("div",{class:"contenteditable",contenteditable:"true",onInput:a=>i.setAnswerToExpandBrackets(a,o)}," Правильный вариант ответа ",40,re)]))),128))])])):b("",!0),t("ul",ne,[t("li",null,[t("button",{class:"btn-card-select-test",onClick:e[5]||(e[5]=o=>i.selectTest("correctAnswer"))},"Правильный вариант ответа")]),t("li",null,[t("button",{class:"btn-card-select-test",onClick:e[6]||(e[6]=o=>i.selectTest("expandBrackets"))},"Раскрыть скобки")])])])}const ae=v(R,[["render",oe],["__scopeId","data-v-5ad339bf"]]),L=D(),le={name:"ExerciseImage",components:{FileLoader:g},props:{exerciseNumber:Number,lessonNumber:Number,path:String,isEditCourse:Boolean},data(){return{exerciseData:{type:"image",name:"",taskDescription:"",path:""},textData:{name:"Название задания",taskDescription:"Описание задания"},editPreview:""}},watch:{isEditCourse:{immediate:!0,handler(s){s&&Object.keys(this.exerciseData).forEach(e=>{this.exerciseData[e]=L.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1][e],e==="path"&&(this.editPreview=this.exerciseData[e]),e==="name"&&(this.textData[e]=this.exerciseData[e]),e==="taskDescription"&&(this.textData[e]=this.exerciseData[e])})}},path(s){s!==""&&s!==void 0&&(this.exerciseData.path=s)},exerciseData:{immediate:!0,deep:!0,handler(s){clearTimeout(this.timeoutWatchExerciseData),this.timeoutWatchExerciseData=setTimeout(()=>{L.$patch(e=>{e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1]={...e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1],...s}})},1e3)}}},methods:{onUploadFile(s={}){s.remove&&this.$emit("onRemoveFile",{exerciseNumber:this.exerciseNumber}),s.success&&this.$emit("onSaveFile",{exerciseNumber:this.exerciseNumber,file:s.file})},setSubTitle(s){this.exerciseData.name=s.target.innerText},setTaskDescription(s){this.exerciseData.taskDescription=s.target.innerText},removeExercise(){this.$emit("onRemoveFile",{exerciseNumber:this.exerciseNumber,path:this.editPreview,isRemoveFileFromSource:!0}),L.lessonItems[this.lessonNumber-1].exerciseItems.splice(this.exerciseNumber-1,1)}}},ce={class:"task"},ue={class:"task-header"},de=["innerHTML"],me=["innerHTML"],he={class:"content-test"};function xe(s,e,r,l,n,i){const o=x("FileLoader");return c(),d("div",ce,[t("div",ue,[t("p",null,"Задание #"+p(r.exerciseNumber),1),t("button",{class:"btn-red",onClick:e[0]||(e[0]=(...u)=>i.removeExercise&&i.removeExercise(...u))},"Удалить задание")]),t("div",{class:"contenteditable sub-title",contenteditable:"true",onInput:e[1]||(e[1]=(...u)=>i.setSubTitle&&i.setSubTitle(...u))},[t("h2",{innerHTML:n.textData.name},null,8,de)],32),t("div",{class:"contenteditable description-task",contenteditable:"true",onInput:e[2]||(e[2]=(...u)=>i.setTaskDescription&&i.setTaskDescription(...u))},[t("h3",{innerHTML:n.textData.taskDescription},null,8,me)],32),t("div",he,[f(o,{"edit-preview":n.editPreview,"id-for":`file_loader_lesson_${r.lessonNumber}_exercise_${r.exerciseNumber}`,"name-form-data":`exercise_${r.lessonNumber}`,"type-file":"image",onOnUploadFile:i.onUploadFile},null,8,["edit-preview","id-for","name-form-data","onOnUploadFile"])])])}const be=v(le,[["render",xe]]),E=D(),pe={name:"ExerciseVideo",components:{FileLoader:g},props:{exerciseNumber:Number,lessonNumber:Number,path:String,isEditCourse:Boolean},data(){return{exerciseData:{type:"video",name:"",taskDescription:"",path:""},textData:{name:"Название задания",taskDescription:"Описание задания"},editPreview:""}},watch:{isEditCourse:{immediate:!0,handler(s){s&&Object.keys(this.exerciseData).forEach(e=>{this.exerciseData[e]=E.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1][e],e==="path"&&(this.editPreview=this.exerciseData[e]),e==="name"&&(this.textData[e]=this.exerciseData[e]),e==="taskDescription"&&(this.textData[e]=this.exerciseData[e])})}},path(s){s!==""&&s!==void 0&&(this.exerciseData.path=s)},exerciseData:{immediate:!0,deep:!0,handler(s){clearTimeout(this.timeoutWatchExerciseData),this.timeoutWatchExerciseData=setTimeout(()=>{E.$patch(e=>{e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1]={...e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1],...s}})},1e3)}}},methods:{onUploadFile(s={}){s.remove&&this.$emit("onRemoveFile",{exerciseNumber:this.exerciseNumber}),s.success&&this.$emit("onSaveFile",{exerciseNumber:this.exerciseNumber,file:s.file})},setSubTitle(s){this.exerciseData.name=s.target.innerText},setTaskDescription(s){this.exerciseData.taskDescription=s.target.innerText},removeExercise(){E.lessonItems[this.lessonNumber-1].exerciseItems.splice(this.exerciseNumber-1,1)}}},_e={class:"task"},fe={class:"task-header"},ve=["innerHTML"],De=["innerHTML"],Ce={class:"content-test"};function Ie(s,e,r,l,n,i){const o=x("FileLoader");return c(),d("div",_e,[t("div",fe,[t("p",null,"Задание #"+p(r.exerciseNumber),1),t("button",{class:"btn-red",onClick:e[0]||(e[0]=(...u)=>i.removeExercise&&i.removeExercise(...u))},"Удалить задание")]),t("div",{class:"contenteditable sub-title",contenteditable:"true",onInput:e[1]||(e[1]=(...u)=>i.setSubTitle&&i.setSubTitle(...u))},[t("h2",{innerHTML:n.textData.name},null,8,ve)],32),t("div",{class:"contenteditable description-task",contenteditable:"true",onInput:e[2]||(e[2]=(...u)=>i.setTaskDescription&&i.setTaskDescription(...u))},[t("h3",{innerHTML:n.textData.taskDescription},null,8,De)],32),t("div",Ce,[f(o,{"edit-preview":n.editPreview,"id-for":`file_loader_lesson_${r.lessonNumber}_exercise_${r.exerciseNumber}`,"name-form-data":`exercise_${r.lessonNumber}`,"type-file":"video",onOnUploadFile:i.onUploadFile},null,8,["edit-preview","id-for","name-form-data","onOnUploadFile"])])])}const Ne=v(pe,[["render",Ie]]),S=D(),Fe={name:"ExerciseAudio",components:{FileLoader:g},props:{exerciseNumber:Number,lessonNumber:Number,path:String,isEditCourse:Boolean},data(){return{exerciseData:{type:"audio",name:"",taskDescription:"",path:""},textData:{name:"Название задания",taskDescription:"Описание задания"},editPreview:""}},watch:{isEditCourse:{immediate:!0,handler(s){s&&Object.keys(this.exerciseData).forEach(e=>{this.exerciseData[e]=S.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1][e],e==="path"&&(this.editPreview=this.exerciseData[e]),e==="name"&&(this.textData[e]=this.exerciseData[e]),e==="taskDescription"&&(this.textData[e]=this.exerciseData[e])})}},path(s){s!==""&&s!==void 0&&(this.exerciseData.path=s)},exerciseData:{immediate:!0,deep:!0,handler(s){clearTimeout(this.timeoutWatchExerciseData),this.timeoutWatchExerciseData=setTimeout(()=>{S.$patch(e=>{e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1]={...e.lessonItems[this.lessonNumber-1].exerciseItems[this.exerciseNumber-1],...s}})},1e3)}}},methods:{onUploadFile(s={}){s.remove&&this.$emit("onRemoveFile",{exerciseNumber:this.exerciseNumber}),s.success&&this.$emit("onSaveFile",{exerciseNumber:this.exerciseNumber,file:s.file})},setSubTitle(s){this.exerciseData.name=s.target.innerText},setTaskDescription(s){this.exerciseData.taskDescription=s.target.innerText},removeExercise(){S.lessonItems[this.lessonNumber-1].exerciseItems.splice(this.exerciseNumber-1,1)}}},ke={class:"task"},ge={class:"task-header"},Te=["innerHTML"],we=["innerHTML"],Le={class:"content-test"};function Ee(s,e,r,l,n,i){const o=x("FileLoader");return c(),d("div",ke,[t("div",ge,[t("p",null,"Задание #"+p(r.exerciseNumber),1),t("button",{class:"btn-red",onClick:e[0]||(e[0]=(...u)=>i.removeExercise&&i.removeExercise(...u))},"Удалить задание")]),t("div",{class:"contenteditable sub-title",contenteditable:"true",onInput:e[1]||(e[1]=(...u)=>i.setSubTitle&&i.setSubTitle(...u))},[t("h2",{innerHTML:n.textData.name},null,8,Te)],32),t("div",{class:"contenteditable description-task",contenteditable:"true",onInput:e[2]||(e[2]=(...u)=>i.setTaskDescription&&i.setTaskDescription(...u))},[t("h3",{innerHTML:n.textData.taskDescription},null,8,we)],32),t("div",Le,[f(o,{"edit-preview":n.editPreview,"id-for":`file_loader_lesson_${r.lessonNumber}_exercise_${r.exerciseNumber}`,"name-form-data":`exercise_${r.lessonNumber}`,"type-file":"audio",onOnUploadFile:i.onUploadFile},null,8,["edit-preview","id-for","name-form-data","onOnUploadFile"])])])}const Se=v(Fe,[["render",Ee]]);const N=D(),Ae={name:"AddLesson",components:{ExerciseAudio:Se,ExerciseVideo:Ne,ExerciseImage:be,ExerciseTestAuto:ae},props:{lessonNumber:Number,courseId:Number,isUploadLessonFiles:Boolean,isEditCourse:Boolean,lessonId:Number|void 0},data(){return{lessonData:{name:"",exerciseItems:[],deleteFiles:{}},textData:{name:"Заголовок"},lessonFiles:new FormData,exerciseFilesIDS:{},timeoutWatchLessonItems:null}},watch:{isEditCourse:{immediate:!0,handler(s){s&&Object.keys(N.lessonItems[this.lessonNumber-1]).forEach(e=>{this.lessonData[e]=N.lessonItems[this.lessonNumber-1][e],e==="name"&&(this.textData[e]=this.lessonData[e])})}},lessonData:{immediate:!0,deep:!0,handler(s){clearTimeout(this.timeoutWatchLessonItems),this.timeoutWatchLessonItems=setTimeout(()=>{N.$patch(e=>{e.lessonItems[this.lessonNumber-1]={...e.lessonItems[this.lessonNumber-1],...s}})},1e3)}},async isUploadLessonFiles(s){if(s){const r=await(await M.fileLoad(this.lessonFiles,"lesson_files",`lesson_id=${this.lessonNumber}`,`exercise_ids=${JSON.stringify(this.exerciseFilesIDS)}`,`course_id=${this.courseId}`)).json();if(!r.success)return this.errorCreateCourse=r;const l=JSON.parse(r.exerciseFiles);for(const n of Object.keys(l))this.isEditCourse&&this.lessonData.exerciseItems[+n-1].path!==""&&(this.lessonData.deleteFiles[n]=this.lessonData.exerciseItems[+n-1].path),this.lessonData.exerciseItems[+n-1].path=l[n]}}},methods:{onSaveFile(s){this.lessonFiles.append(`exercise_${s.exerciseNumber}`,s.file),this.exerciseFilesIDS[+s.exerciseNumber]=""},onRemoveFile(s){if(s.isRemoveFileFromSource){this.lessonData.deleteFiles[+s.exerciseNumber-1]=s.path;return}this.lessonFiles.delete(`exercise_${s.exerciseNumber}`),delete this.exerciseFilesIDS[s.exerciseNumber]},addExercise(s){this.lessonData.exerciseItems.push({exerciseNumber:this.lessonData.exerciseItems.length+1,type:s,name:"Название задания",taskDescription:"Описание задания"})},setLessonName(s){this.lessonData.name=s.target.innerText},removeLesson(){N.$patch(s=>{const e={lessonId:this.lessonNumber-1,paths:[]};for(let r=0;r<this.lessonData.exerciseItems.length;r++){const l=this.lessonData.exerciseItems[r];l.path!==void 0&&l.path!==""&&e.paths.push(l.path)}e.paths.length!==0&&s.deleteLessonFileItems.push(e),this.lessonId!==0&&this.lessonId!==void 0&&s.deleteLessonItems.push(this.lessonId),s.lessonItems.splice(this.lessonNumber-1,1)})}}},j=s=>(B("data-v-8d3b938d"),s=s(),U(),s),Oe={class:"lesson-component"},ye={class:"lesson-component-header"},Be={class:"lesson-exercise"},Ue={class:"title"},Me=["innerHTML"],je={class:"exercise-list"},Pe={class:"task-panel"},He=j(()=>t("button",{class:"btn-blue"},"Добавить задание >",-1)),Ve={class:"task-list"},Re=j(()=>t("div",{class:"lesson-task"},null,-1));function We(s,e,r,l,n,i){const o=x("ExerciseTestAuto"),u=x("ExerciseImage"),a=x("ExerciseVideo"),A=x("ExerciseAudio");return c(),d("div",Oe,[t("div",ye,[t("p",null,"Урок #"+p(r.lessonNumber),1),t("button",{class:"btn-red",onClick:e[0]||(e[0]=(...m)=>i.removeLesson&&i.removeLesson(...m))},"Удалить урок")]),t("div",Be,[t("div",Ue,[t("div",{class:"contenteditable",contenteditable:"true",onInput:e[1]||(e[1]=(...m)=>i.setLessonName&&i.setLessonName(...m))},[t("h1",{innerHTML:n.textData.name},null,8,Me)],32)]),t("div",je,[(c(!0),d(F,null,k(n.lessonData.exerciseItems,(m,P)=>(c(),d("div",{key:`exercise_${P}`,class:"exercise-item"},[m.type==="testAuto"?(c(),I(o,{key:0,"exercise-number":m.exerciseNumber,"is-edit-course":r.isEditCourse,"lesson-number":r.lessonNumber},null,8,["exercise-number","is-edit-course","lesson-number"])):b("",!0),m.type==="image"?(c(),I(u,{key:1,"exercise-number":m.exerciseNumber,"is-edit-course":r.isEditCourse,"lesson-number":r.lessonNumber,path:m.path,onOnSaveFile:i.onSaveFile,onOnRemoveFile:i.onRemoveFile},null,8,["exercise-number","is-edit-course","lesson-number","path","onOnSaveFile","onOnRemoveFile"])):b("",!0),m.type==="video"?(c(),I(a,{key:2,"exercise-number":m.exerciseNumber,"is-edit-course":r.isEditCourse,"lesson-number":r.lessonNumber,path:m.path,onOnSaveFile:i.onSaveFile,onOnRemoveFile:i.onRemoveFile},null,8,["exercise-number","is-edit-course","lesson-number","path","onOnSaveFile","onOnRemoveFile"])):b("",!0),m.type==="audio"?(c(),I(A,{key:3,"exercise-number":m.exerciseNumber,"is-edit-course":r.isEditCourse,"lesson-number":r.lessonNumber,path:m.path,onOnSaveFile:i.onSaveFile,onOnRemoveFile:i.onRemoveFile},null,8,["exercise-number","is-edit-course","lesson-number","path","onOnSaveFile","onOnRemoveFile"])):b("",!0)]))),128))]),t("div",Pe,[He,t("div",Ve,[t("button",{class:"btn-blue",onClick:e[2]||(e[2]=m=>i.addExercise("video"))},"Видео-задание"),t("button",{class:"btn-blue",onClick:e[3]||(e[3]=m=>i.addExercise("audio"))},"Аудио-задание"),t("button",{class:"btn-blue",onClick:e[4]||(e[4]=m=>i.addExercise("image"))},"Задание с изображением"),t("button",{class:"btn-blue",onClick:e[5]||(e[5]=m=>i.addExercise("testAuto"))},"Тест с авто-проверкой")])])]),Re])}const Je=v(Ae,[["render",We],["__scopeId","data-v-8d3b938d"]]);const h=D(),$e={props:{isEditCourse:Boolean},data(){return{dataCourse:{name:"",language:"english",description:"",price:0,free:!1,hidden:!1,mainVideo:"",mainImg:"",lessonItems:[]},files:new FormData,isUploadLessonFiles:!1,courseId:0,timeoutWatchDataCourse:null,errorCreateCourse:null,isButtonCreateCourseDisabled:!1,isEditDataLoaded:!1}},watch:{isEditCourse:{immediate:!0,async handler(s){s&&(await h.sendGetCourseByID(this.courseId).then(e=>{const r=e.courseData;h.name=r.name,h.language=r.language,h.description=r.description||"",h.price=r.price||0,document.getElementById("price").value=h.price||"",h.hidden=r.hidden||!1,h.free=!r.price,h.lessonItems=e.lessonDataItems!==void 0?e.lessonDataItems.map(l=>({exerciseItems:JSON.parse(l.exerciseJson),id:l.id,lessonNumber:l.lessonNumber,name:l.name})).sort((l,n)=>l.lessonNumber>n.lessonNumber):[],this.dataCourse.mainImg=r.mainImg,this.dataCourse.mainVideo=r.mainVideo,this.isEditDataLoaded=!0}),Object.keys(this.dataCourse).forEach(e=>{h[e]!==void 0&&(this.dataCourse[e]=h[e])}))}},dataCourse:{handler(s){clearTimeout(this.timeoutWatchDataCourse),this.timeoutWatchDataCourse=setTimeout(()=>{h.$patch({...s})},1e3)},immediate:!0,deep:!0}},methods:{onUploadFile(s={}){s.remove&&this.files.delete(s.nameFormData),s.success&&this.files.append(s.nameFormData,s.file)},setPrice(s){const e=s.target.value.replace(/[a-zа-яё\s]/gi,"").replace(/[^a-zа-яё0-9\s]/gi,"");this.dataCourse.price=+e,s.target.value=e},setLessonComponent(s){this.dataCourse.lessonItems.push({lessonNumber:this.dataCourse.lessonItems.length+1,name:"Название урока",exerciseItems:[],taskDescription:""})},async fileUpload(){const e=await(await M.fileLoad(this.files,"main_files",`course_id=${this.courseId}`)).json();if(!e.success)return this.errorCreateCourse=e},async saveCourse(){if(this.isButtonCreateCourseDisabled)return;this.isButtonCreateCourseDisabled=!0;const s={};this.files.get("mainFile")!==null&&(this.files.get("mainFile").type.includes("image/")&&(s.mainFileImg=this.dataCourse.mainImg),this.files.get("mainFile").type.includes("video/")&&(s.mainFileVideo=this.dataCourse.mainVideo));const r=await(await h.sendSaveCourse(s)).json();if(r.status!==200)return this.errorCreateCourse=r;this.courseId=r.courseId,this.isUploadLessonFiles=!0,setTimeout(async()=>{const n=await(await h.sendSaveLessonForSavedCourse(this.courseId)).json();if(!n.success)return this.errorCreateCourse=n},3e3),await this.fileUpload()},async createCourse(){if(this.isButtonCreateCourseDisabled)return;this.isButtonCreateCourseDisabled=!0;const e=await(await h.sendCreateCourse()).json();if(!e.success)return this.errorCreateCourse=e;this.courseId=e.courseId,this.isUploadLessonFiles=!0,setTimeout(async()=>{const l=await(await h.sendAddLessonsToCreatedCourse(this.courseId)).json();if(!l.success)return this.errorCreateCourse=l},3e3),await this.fileUpload()}},components:{FileLoader:g,AddLesson:Je}},_=s=>(B("data-v-94ebf447"),s=s(),U(),s),ze={class:"component"},Ge={class:"title"},qe={key:0},Ke={key:1},Qe={class:"component-block-input"},Xe=_(()=>t("h2",null,"Главная информация для курса",-1)),Ye={class:"data-input"},Ze=_(()=>t("p",null,"Название курса",-1)),es={class:"data-input"},ss=_(()=>t("p",null,"Выберите язык курса",-1)),ts=_(()=>t("option",{value:"english"},"Английский",-1)),is=[ts],rs={class:"data-input"},ns=_(()=>t("p",null,"Описание курса",-1)),os={class:"data-input"},as=_(()=>t("p",null,"Цена курса",-1)),ls={class:"block_checkbox"},cs=_(()=>t("label",{for:"free_course"},"Бесплатный курс?",-1)),us=["disabled"],ds={class:"data-input"},ms={class:"block_checkbox"},hs=_(()=>t("label",{for:"hidden_course"},"Скрыть курс?",-1)),xs={class:"file-loader-section"},bs={class:"create-lessons"},ps={class:"finally"},_s={key:0,class:"error-message"},fs=["disabled"],vs=["disabled"];function Ds(s,e,r,l,n,i){const o=x("FileLoader"),u=x("AddLesson");return c(),d("div",ze,[t("section",Ge,[r.isEditCourse?(c(),d("h1",Ke,"Редактировать курс")):(c(),d("h1",qe,"Создать курс"))]),t("section",Qe,[Xe,t("div",Ye,[Ze,C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>n.dataCourse.name=a),class:"input",maxlength:"200",name:"name_course",type:"text"},null,512),[[O,n.dataCourse.name]])]),t("div",es,[ss,C(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>n.dataCourse.language=a),name:"language_course"},is,512),[[V,n.dataCourse.language]])]),t("div",rs,[ns,C(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>n.dataCourse.description=a),maxlength:"5000",name:"course_description"},null,512),[[O,n.dataCourse.description]])]),t("div",os,[as,t("div",ls,[C(t("input",{id:"free_course","onUpdate:modelValue":e[3]||(e[3]=a=>n.dataCourse.free=a),class:"input_checkbox",name:"free_course",type:"checkbox"},null,512),[[y,n.dataCourse.free]]),cs]),t("input",{id:"price",class:T([{"input-disabled":this.dataCourse.free},"input number_input"]),disabled:this.dataCourse.free,maxlength:"6",name:"price_course",type:"text",onInput:e[4]||(e[4]=a=>i.setPrice(a))},null,42,us)]),t("div",ds,[t("div",ms,[C(t("input",{id:"hidden_course","onUpdate:modelValue":e[5]||(e[5]=a=>n.dataCourse.hidden=a),class:"input_checkbox",name:"hidden_course",type:"checkbox"},null,512),[[y,n.dataCourse.hidden]]),hs])]),t("div",xs,[f(o,{"edit-preview":n.dataCourse.mainImg,"id-for":"file_loader_image","name-form-data":"mainFile","type-file":"image",onOnUploadFile:i.onUploadFile},null,8,["edit-preview","onOnUploadFile"]),f(o,{"edit-preview":n.dataCourse.mainVideo,"id-for":"file_loader_video","name-form-data":"mainFile","type-file":"video",onOnUploadFile:i.onUploadFile},null,8,["edit-preview","onOnUploadFile"])])]),t("section",bs,[(c(!0),d(F,null,k(this.dataCourse.lessonItems,(a,A)=>(c(),d("div",{key:`add_lesson_${a.lessonNumber}`},[f(u,{"course-id":n.courseId,"is-edit-course":n.isEditDataLoaded,"is-upload-lesson-files":n.isUploadLessonFiles,"lesson-id":a.id,"lesson-number":a.lessonNumber},null,8,["course-id","is-edit-course","is-upload-lesson-files","lesson-id","lesson-number"])]))),128)),t("button",{class:"btn-blue",onClick:e[6]||(e[6]=a=>i.setLessonComponent())}," Добавить урок ")]),t("section",ps,[n.errorCreateCourse!==null?(c(),d("p",_s,p(n.errorCreateCourse.error),1)):b("",!0),r.isEditCourse?(c(),d("button",{key:2,class:T([{"btn-disabled":n.isButtonCreateCourseDisabled},"btn-blue"]),disabled:n.isButtonCreateCourseDisabled,onClick:e[8]||(e[8]=(...a)=>i.saveCourse&&i.saveCourse(...a))}," Сохранить ",10,vs)):(c(),d("button",{key:1,class:T([{"btn-disabled":n.isButtonCreateCourseDisabled},"btn-blue"]),disabled:n.isButtonCreateCourseDisabled,onClick:e[7]||(e[7]=(...a)=>i.createCourse&&i.createCourse(...a))}," Создать ",10,fs))])])}const Cs=v($e,[["render",Ds],["__scopeId","data-v-94ebf447"]]),ks=Object.freeze(Object.defineProperty({__proto__:null,default:Cs},Symbol.toStringTag,{value:"Module"}));export{Cs as C,ks as a,D as u};
//# sourceMappingURL=CreateCourse-8c304784.js.map
